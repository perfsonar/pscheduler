#!/bin/sh -e
#
# Run the database install/upgrade scripts.
#
# Both scripts are nondestructive, so it's safe to run this as many
# times as you want.  The result will always be a database with the
# latest version of the tables and functions.
#

if [ $(id -u) -ne 0 ]
then
    echo "This command must be run as root."
    exit 1
fi

[ -t 0 -a -t 1 -a -t 2 ] && INTERACTIVE=true || INTERACTIVE=false

$INTERACTIVE && printf "Loading database:\n"

$INTERACTIVE && printf '    Administrative...'
postgresql-load '__DATADIR__/database-build-super.sql'
$INTERACTIVE && printf ' Done.\n'

$INTERACTIVE && printf '    User __ROLE__...'
postgresql-load --role '__ROLE__' '__DATADIR__/database-build.sql'
$INTERACTIVE && printf ' Done.\n'
