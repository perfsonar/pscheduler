#!/usr/bin/env python3
#   
# Determine the duration of the qperf

import pscheduler

import qperf_defaults
import qperf_utils

logger = pscheduler.Log(prefix='tool-qperf', quiet=True)

json = pscheduler.json_load(exit_on_error=True)['spec']


# Setup:  How long it takes to connect and set up the test
setup = qperf_utils.setup_time(json.get('link-rtt'))


# Duration: How long the test should run

duration = json.get('duration', qperf_defaults.DEFAULT_DURATION)
delta = pscheduler.iso8601_as_timedelta(duration)
duration = int(pscheduler.timedelta_as_seconds(delta))



full_duration = setup + duration + qperf_defaults.DEFAULT_WAIT_SLEEP + qperf_defaults.DEFAULT_SERVER_SHUTDOWN
logger.debug(f'final duration = {full_duration}s')


pscheduler.succeed_json({
        'duration': f'PT{full_duration}S'
})
