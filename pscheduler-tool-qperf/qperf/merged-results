#!/usr/bin/env python3

import pscheduler

logger = pscheduler.Log(quiet=True)

input = pscheduler.json_load(exit_on_error=True)

try:
    result_list = input['results']
except KeyError as ex:
    logger.error(f'merged-result error {ex}')
    pscheduler.fail(f'Missing required key in merged-result input: {ex}')

result_len = len(result_list)
if not(result_len == 2):
    pscheduler.fail(f'Expected 2 results in merged-results, got {result_len}')

source_results = result_list[0]
dest_results = result_list[1]
final_results = source_results


# it's possible one could come back as null, ensure we have the right type
if not final_results:
    final_results = {'succeeded': False}

final_diag = ''

if source_results and source_results.get('diags'):
    final_diag += f'Participant 0:\n{source_results.get("diags")}\n'

if dest_results and dest_results.get('diags'):
    final_diag += f'Participant 1:\n{dest_results.get("diags")}\n'

final_results['diags'] = final_diag

pscheduler.succeed_json(final_results)
