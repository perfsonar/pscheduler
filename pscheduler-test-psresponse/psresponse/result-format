#!/usr/bin/env python3
#
# Format a result
#

import html
import json
import jsontemplate
import pscheduler
import sys

from validate import result_is_valid
from validate import MAX_SCHEMA

try:
   format = sys.argv[1]
except IndexError:
   format = 'text/plain'

input = pscheduler.json_load(exit_on_error=True, max_schema=MAX_SCHEMA)

valid, message = result_is_valid(input["result"])

if not valid:
    pscheduler.fail(message)

result = input["result"]
spec = input["spec"]

if format == 'text/plain':

   print('Response Time: %s' % result['time'])

   try:
      print('Status Code: %s' % result['status']) 
   except KeyError:
      pass

elif format == 'text/html':

    print('<table>')
    print('<tr>') 
    print('<td>Response Time</td>')
    print('<td>%s</td>' % result['time'])
    print('</tr>')

    print('<tr>')
    print('<td>Status Code</td>')
    print('<td>%s</td>' % result['status'])
    print('</tr>')

    print('</table>')

else:
   pscheduler.fail("Unsupported format '%s'" % format)
