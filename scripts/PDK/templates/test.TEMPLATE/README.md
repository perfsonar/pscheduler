## Creating and Understanding a pScheduler Test

## Anatomy of a Test

### enumerate

This is the first file you want to edit when developing your test. Not much needs to be done to complete this file, most of it will be filled in when you run the PDK to create your test. You will need to add a brief description of your test. The description does not need to be long, it just needs to have enough information to make it clear what the test is for and what it does. You'll also want to verify the information filled in by the PDK to make sure it is accurate. If you ever need to change the name of your test, make sure to update this file with the correct information.

### validate.py

This file represents a significant portion of the development work for a test. It defines both the validity of the input spec and the results format. The JSON types used in this file can be found here: https://github.com/perfsonar/pscheduler/blob/master/python-pscheduler/pscheduler/pscheduler/jsonval.py as they are pScheduler specific. Most of the time, you will want to preserve the properties in this file that are given to you in the template. However, they may not be required so make sure to modify that aspect if needed. Required properties are the inputs absolutely needed to run the test; they need to have values specified at the time the test is run. Without them, the test and tool will not have enough information to run and will fail. Generally, try to make as few properties as possible required properties. You can add default values to allow a test to be run without a certain property having a value specified. If the underlying tool offers defaults itself, you also can rely on those when considering if a property needs to be required. Typically, limit_is_valid does not need to be edited after the PDK is run.

### cli-to-spec

This file also represents a significant portion of the development work for a test. Most of the work in this file is adding in the options that the test can use to run and then processing which options are required and adding defaults for ones that are not and that the tool does not provide built-in defaults for. When adding options, make sure to follow the same format as the options provided in the PDK template. The name of the option should match the property you specified in validate.py. The help section should be a brief string describing the property and it's helpful to include the formatting you're expecting for the option when the test is being invoked. This string will appear if a user neglects to provide a required option or incorrectly invokes any option. The type of an option will typically be a string or a number, make sure to set an appropriate type for your argument. There needs to be an option in this file (in the schema section, not the results section) for every property you specified in validate.py, whether the option is required according to validate.py or not. The options given by the PDK template show how to check if an option was given on the command line and how to cause a fail state if a required option is missing or an option has values that aren't accepted. If you do not need an option to run the test, you can simply check to see if the value is None and there is no need for an else statement. If you need to act based on the missing information, either because it's a required option with no value given or because you need to insert a default value, you'll need to add an else statement and take the correct action there. The testtype option from the PDK template provides a good example of how to check to see if the value given for an option falls in a list of expected values. Typically, if an unexpected value is given, you'll want to fail instead of providing a default in case the user provided a meaningful option that simply had a typo or was formatted incorrectly. There's a variety of ways for options to not be acceptable based on what's expected. Values may need to fall in a certain range or have a certain prefix or postfix, etc. There's lots of ways to check these things because the syntax used here is pure Python 3. It's up to you to enforce how required options will be dealt with here, so make sure to address all of them appropriately. Generally, you do not want to edit any of the other code provided by the template.

### spec-to-cli

This file requires some relatively minor edits. You'll need to add tuples for all your arguments in the same format as the default arguments provided by the PDK template. These are input arguments only. Make sure to include ALL arguments, whether they are required or not.

### spec-is-valid

You most likely will not need to edit this file after it is generated by the PDK. It checks to see if a test spec is valid. You do your specification of validity in other files so that this file can successfully do it's job without direct edits.

### participants

You most likely will not need to edit this file after it is generated by the PDK. It outputs the list of the hostnames/IP addresses participating in the test.

### result-format

This file formats the result of the test in both html and plain text format. This file will probably require a significant amount of development work. All of the data specified in validate.py as being a part of the result will need to be presented here in a human readable way. The plain text is a python printout. A bit of an example is provided by the PDK template and you can also look at pre-existing tests to get a feel for what output usually looks like and how it is formatted. Your actual output will be very specific to your individual tests but the formatting for pScheduler test output tends to be very similar. The html output should contain everything the plain text output does, but it will be formatted to be a well-organized html webpage. Pre-existing plugins should also have good examples of this. It doesn't need to be fancy, but a basic knowledge of html will probably be necessary to complete this.

### spec format

This file is very similar to result-format but it operates on the spec instead of the result. It formats the spec JSON into something human readable in both plain text and html format. You can look at pre-existing plugins here as well to see how the formatting of the spec usually is arranged.
