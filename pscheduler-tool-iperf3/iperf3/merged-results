#!/usr/bin/python
#
#NOTE: THIS NEEDS A LOT OF WORK. 
# Merge overal is not working quite right so lost of code that just prevents things from exploding
# Merge the participant results of a run by this tool into a
# test-standard result.
#


import pscheduler

logger = pscheduler.Log(quiet=True)

input = pscheduler.json_load(exit_on_error=True)

results = {'succeeded': False}

try:
    result_list = input['results']
except KeyError as e:
    logger.error("merged-result error %s" % e)
    pscheduler.fail("Missing required key in merged-result input: %s" % e)


client_results = result_list[0]
server_results = result_list[1]

final_diag = ""

if client_results and client_results.get('diags'):
    final_diag += "Participant 0:\n%s\n" % client_results.get('diags')

if server_results and server_results.get('diags'):
    final_diag += "Participant 1:\n%s\n" % server_results.get('diags')

client_results['diags'] = final_diag

pscheduler.succeed_json(client_results)
